$(function(){Department.load('#companyId','#departmentId','crm.managerCompany');$('#exportExcel1').click(function(){this.href=ReportProcessing.exportExcel1();this.download="So sánh doanh thu tháng trước.xls";return true;});$('#exportExcel2').click(function(){this.href=ReportProcessing.exportExcel2();this.download="So sánh chăm sóc tháng trước.xls";return true;});});var ReportProcessing={exportExcel1:function(){var worksheet_template='<?xml version="1.0"?><ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'+'<ss:Styles>'+'<ss:Style ss:ID="1"><ss:Font /></ss:Style></ss:Styles><ss:Worksheet ss:Name="Sheet1">'+'<ss:Table>{{ROWS}}</ss:Table></ss:Worksheet></ss:Workbook>';var row_template='<ss:Row ss:StyleID="1">{{CELLS}}</ss:Row>';var cell_template='<ss:Cell><ss:Data ss:Type="String">{{name}}</ss:Data></ss:Cell>';var header='';var rows='';header+=cell_template.replace('{{name}}','STT');header+=cell_template.replace('{{name}}','Phòng ban');header+=cell_template.replace('{{name}}','NV tháng này');header+=cell_template.replace('{{name}}','HĐ tháng này');header+=cell_template.replace('{{name}}','Giá trị tháng này');header+=cell_template.replace('{{name}}','Đã thu tháng này');header+=cell_template.replace('{{name}}','Tính doanh số tháng này');header+=cell_template.replace('{{name}}','NV tháng trước');header+=cell_template.replace('{{name}}','HĐ tháng trước');header+=cell_template.replace('{{name}}','Giá trị tháng trước');header+=cell_template.replace('{{name}}','Đã thu tháng trước');header+=cell_template.replace('{{name}}','Tính doanh số tháng trước');header+=cell_template.replace('{{name}}','NV(%)');header+=cell_template.replace('{{name}}','Hợp đồng(%)');header+=cell_template.replace('{{name}}','Giá trị(%)');header+=cell_template.replace('{{name}}','Đã thu(%)');header+=cell_template.replace('{{name}}','Tính doanh số(%)');rows+=row_template.replace('{{CELLS}}',header);$('#dgCrmReportDepartment1 tbody tr').each(function(){var cells='';$(this).find('td').each(function(){cells+=cell_template.replace('{{name}}',$(this).text());});rows+=row_template.replace('{{CELLS}}',cells);});console.log(rows);var worksheet=worksheet_template.replace('{{ROWS}}',rows);worksheet=worksheet.replace(/ /g,'%20');return'data:application/vnd.ms-excel,'+worksheet;},exportExcel2:function(){var worksheet_template='<?xml version="1.0"?><ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'+'<ss:Styles>'+'<ss:Style ss:ID="1"><ss:Font /></ss:Style></ss:Styles><ss:Worksheet ss:Name="Sheet1">'+'<ss:Table>{{ROWS}}</ss:Table></ss:Worksheet></ss:Workbook>';var row_template='<ss:Row ss:StyleID="1">{{CELLS}}</ss:Row>';var cell_template='<ss:Cell><ss:Data ss:Type="String">{{name}}</ss:Data></ss:Cell>';var header='';var rows='';header+=cell_template.replace('{{name}}','STT');header+=cell_template.replace('{{name}}','Phòng ban');header+=cell_template.replace('{{name}}','NV tháng này');header+=cell_template.replace('{{name}}','Tìm tháng này');header+=cell_template.replace('{{name}}','Gọi tháng này');header+=cell_template.replace('{{name}}','Gặp tháng này');header+=cell_template.replace('{{name}}','NV tháng trước');header+=cell_template.replace('{{name}}','Tìm tháng trước');header+=cell_template.replace('{{name}}','Gọi tháng trước');header+=cell_template.replace('{{name}}','Gặp tháng trước');header+=cell_template.replace('{{name}}','NV(%)');header+=cell_template.replace('{{name}}','Tìm(%)');header+=cell_template.replace('{{name}}','Gọi(%)');header+=cell_template.replace('{{name}}','Gặp(%)');rows+=row_template.replace('{{CELLS}}',header);$('#dgCrmReportDepartment2 tbody tr').each(function(){var cells='';$(this).find('td').each(function(){cells+=cell_template.replace('{{name}}',$(this).text());});rows+=row_template.replace('{{CELLS}}',cells);});console.log(rows);var worksheet=worksheet_template.replace('{{ROWS}}',rows);worksheet=worksheet.replace(/ /g,'%20');return'data:application/vnd.ms-excel,'+worksheet;}};if(typeof google!=="undefined"){google.load("visualization","1.1",{packages:["bar"]});google.setOnLoadCallback(drawChart);}
function drawChart(){var formatter=new google.visualization.NumberFormat({pattern:'#,###'});var table=$('#dgCrmReportDepartment1');var totalRows=table.find('tr').length;var totalColums=table.find('tr:eq(1) td').length;var productData=new google.visualization.DataTable();productData.addColumn('string','Phòng ban');productData.addColumn('number','Tháng trước');productData.addColumn('number','Tháng này');for(var i=2;i<totalRows-1;i++){var row=[table.find('tr:eq('+i+') td:eq(1)').text()];var paymentThisMonth=table.find('tr:eq('+i+') td:eq(9)').text();if(paymentThisMonth!=null){row.push(parseInt(paymentThisMonth.replace(nfsReg,'')));}
var paymentLastMonth=table.find('tr:eq('+i+') td:eq(5)').text();if(paymentLastMonth!=null){row.push(parseInt(paymentLastMonth.replace(nfsReg,'')));}
console.log(row);productData.addRow(row);}
var options={chart:{title:' So sánh doanh thu phòng ban',subtitle:'',}};var chart=new google.charts.Bar(document.getElementById('chart'));chart.draw(productData,options);}