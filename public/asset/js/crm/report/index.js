if(typeof google!=="undefined"){google.load('visualization','1.0',{'packages':['corechart']});google.setOnLoadCallback(drawChart);}
function drawChart(){var formatter=new google.visualization.NumberFormat({pattern:'#,###'});var table=$('#dgCrmReportIndex');var totalRows=table.find('tr').length;var dataMoney=new google.visualization.DataTable();dataMoney.addColumn('string','Thời gian');dataMoney.addColumn('number','Tìm');dataMoney.addColumn('number','Gọi thành công');dataMoney.addColumn('number','Gọi thất bại');dataMoney.addColumn('number','Gặp');dataMoney.addColumn('number','Hẹn');dataMoney.addColumn('number','Triển khai');dataMoney.addColumn('number','Nhân viên');dataMoney.addColumn('number','Khách hàng');dataMoney.addColumn('number','Hợp đồng');for(var i=2;i<totalRows-1;i++){var rowMoney=[table.find('tr:eq('+i+') td:eq(0)').text()];rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(1)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(2)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(3)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(4)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(5)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(6)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(7)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(8)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(9)').text().replace(nfsReg,'')));dataMoney.addRow(rowMoney);}
formatter.format(dataMoney,1);formatter.format(dataMoney,2);formatter.format(dataMoney,3);formatter.format(dataMoney,4);formatter.format(dataMoney,5);formatter.format(dataMoney,6);formatter.format(dataMoney,7);formatter.format(dataMoney,8);formatter.format(dataMoney,9);var moneyOptions={'title':titleFirstChart,'height':300,lineWidth:2,pointSize:3};var moneyChart=new google.visualization.LineChart(document.getElementById('crm-chart'));moneyChart.draw(dataMoney,moneyOptions);var dataMoney=new google.visualization.DataTable();dataMoney.addColumn('string','Thời gian');dataMoney.addColumn('number','Giá trị HD');dataMoney.addColumn('number','Đã thu');for(var i=2;i<totalRows-1;i++){var rowMoney=[table.find('tr:eq('+i+') td:eq(0)').text()];rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(10)').text().replace(nfsReg,'')));rowMoney.push(parseInt(table.find('tr:eq('+i+') td:eq(11)').text().replace(nfsReg,'')));dataMoney.addRow(rowMoney);}
formatter.format(dataMoney,1);formatter.format(dataMoney,2);var moneyOptions={'title':titleSecondChart,'height':300,lineWidth:2,pointSize:3};var moneyChart=new google.visualization.LineChart(document.getElementById('crm-chart-revenue'));moneyChart.draw(dataMoney,moneyOptions);}
$(function(){Department.load('#companyId','#departmentId');$('input.date-range-picker').each(function(){var option={format:'DD/MM/YYYY',ranges:{'Today':[moment(),moment()],'Yesterday':[moment().subtract(1,'days'),moment().subtract(1,'days')],'Last 7 Days':[moment().subtract(6,'days'),moment()],'Last 30 Days':[moment().subtract(29,'days'),moment()],'This Month':[moment().startOf('month'),moment().endOf('month')],'Last Month':[moment().subtract(1,'month').startOf('month'),moment().subtract(1,'month').endOf('month')]},showDropdowns:true,};if($(this).attr('timePicker')){option['timePicker']=true;}else{option['timePicker']=false;}
$(this).daterangepicker(option);});$('#createdByName').autocomplete({source:function(request,response){$.post('/system/user/suggest',{'q':request.term},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){$('#createdById').val(ui.item.id);},});$('#createdByName').on('change',function(){if(!$('#createdByName').val()){$('#createdById').val('');}});});