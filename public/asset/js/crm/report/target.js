var TargetGroup={load:function(cId,dId){var c=cId?cId:'#companyId';var d=dId?dId:'#groupId';if($(c).val()&&!$(d).val()){TargetGroup.getTargetGroups($(c).val(),d);}
$(c).change(function(){if($(this).val()&&$(d).length){TargetGroup.getTargetGroups($(this).val(),d);}});},getTargetGroups:function(cid,dId,sel){$.post('/crm/target/load?companyId='+cid,{},function(rp){if(rp.code){TargetGroup.update(dId,rp.data,sel);}else{TargetGroup.update(dId,[],sel);}},'json');},update:function(id,d,sel){if($(id).length){var options="";for(var i in d){var item=d[i];if(sel==item.id){options+="<option selected value='"+item.id+"'>"+item.name+"</option>";}else{options+="<option value='"+item.id+"'>"+item.name+"</option>";}}
if(!$(id).find('option:first').val()){options="<option value=''>"+$(id).find('option:first').text()+"</option>"+options;}
$(id).html(options);}}};$(function(){$('#extractDepartmentIds').multiselect({enableCaseInsensitiveFiltering:true,nonSelectedText:'Loại trừ phòng ban'});$('#productId').multiselect({enableCaseInsensitiveFiltering:true,nonSelectedText:'Sản phẩm'});DepartmentController.initLoadSelectBox('#departmentId','#contractCompanyId',{param:{'page':'crm.managerCompany'}});DepartmentController.initLoadSelectBox('#employeeDepartmentId','#companyId',{param:{'page':'crm.managerCompany'}});$('input.date-range-picker').each(function(){var option={format:'DD/MM/YYYY',ranges:{'Today':[moment(),moment()],'Yesterday':[moment().subtract(1,'days'),moment().subtract(1,'days')],'Last 7 Days':[moment().subtract(6,'days'),moment()],'Last 30 Days':[moment().subtract(29,'days'),moment()],'This Month':[moment().startOf('month'),moment().endOf('month')],'Last Month':[moment().subtract(1,'month').startOf('month'),moment().subtract(1,'month').endOf('month')]},showDropdowns:true,};if($(this).attr('timePicker')){option['timePicker']=true;}else{option['timePicker']=false;}
$(this).daterangepicker(option)});$('#employeeName').autocomplete({source:function(request,response){$.post('/system/user/suggest',{'q':request.term,'page':'crm.report','companyId':$('#companyId').val(),'departmentId':$('#departmentId').val()},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){$('#userId').val(ui.item.id);},});$('#employeeName').on('change',function(){if(!$('#employeeName').val()){$('#userId').val('');}});$('#departmentId').select2({'placeholder':'Phòng ban hưởng doanh số','dropdownAutoWidth':true});$('#employeeDepartmentId').select2({'placeholder':'Phòng ban của nhân viên','dropdownAutoWidth':true});$('#companyId').select2({'placeholder':'Công ty','dropdownAutoWidth':true});$('#contractCompanyId').select2({'placeholder':'Công ty','dropdownAutoWidth':true});});$('#exportExcel').jsExcelExport({'param':{'format':'excel'}});