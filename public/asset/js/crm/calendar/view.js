$(function(){$('#calendar').fullCalendar({header:{left:'prev,next today',center:'title',right:'month,agendaWeek,agendaDay'},viewRender:function(view,element){$('#calendar').fullCalendar('removeEvents');$.post('/crm/calendar/personalload',{startDate:view.start.format('YYYY-MM-DD'),endDate:view.end.format('YYYY-MM-DD')},function(rs){var events=[];if(rs.code){for(var i in rs.data){events.push(rs.data[i])}}
console.log(events);$('#calendar').fullCalendar('addEventSource',events);});},eventClick:function(calEvent,jsEvent,view){$('#viewEventModal .modal-body').html('');$('#viewEventModal .edit-event').attr('href','#');$.post('/crm/calendar/viewevent',{id:calEvent.id},function(rs){$('#viewEventModal .modal-body').html(rs);$('#viewEventModal .edit-event').attr('href','/crm/calendar/edit?id='+calEvent.id);$('#viewEventModal .withdraw').attr('data-idref',calEvent.id)});$('#viewEventModal').modal('show');}});$('#viewEventModal .withdraw').click(function(){var id=$(this).attr('data-idref');if(!id||id=='undefined'){return false;}
$('#viewEventModal').modal('hide');$('#confirmModal .modal-body').html(deleteEventMsg);$('#confirmModal .modal-hidden-data').val(id);$('#confirmModal').modal('show');});$('#confirmModal .confirm-yes').click(function(){var id=$('#confirmModal .modal-hidden-data').val();if(!id||id=='undefined'){return false;}
$.post('/crm/calendar/selfwithdraw',{id:id},function(rs){if(rs.code){$('#confirmModal').modal('hide');$('#calendar').fullCalendar('removeEvents',id);}else{$('#errorModal .modal-body').html(rs.messages.join('<br/>'));$('#confirmModal').modal('hide');$('#errorModal').modal('show');}});})});