var isSubmit=false;$(function(){Department.load('#companyId','#departmentId');$('#exportExcel').jsExcelExport({'param':{'format':'excel'}});$('#exportAll').jsExcelExport({'param':{'format':'csv'}});$('#stampedByName').autocomplete({source:function(request,response){$.post('/system/user/suggest',{'q':request.term,'companyId':$('#companyId').val()},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){$('#stampedById').val(ui.item.id);},});$('#stampedByName').on('change',function(){if(!$('#stampedByName').val()){$('#stampedById').val('');}});$('#createdByName').autocomplete({source:function(request,response){$.post('/system/user/suggest',{'q':request.term,'companyId':$('#companyId').val()},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){$('#createdById').val(ui.item.id);},});$('#createdByName').on('change',function(){if(!$('#createdByName').val()){$('#createdById').val('');}});$('.deteleBill').click(function(){var id=$(this).attr('data-id');var html="<div class='alert alert-info alert-dismissable'>Bạn chắc chắn xóa doanh số này?</div>";$("#myModal").modal('show');$('#myModal .modal-body').empty();$('#myModal .modal-body').append(html);$('#myModal .modal-footer').append("<div class='deleteId' value='"+id+"'></div>");});$('#myModal .modal-footer').on('click','.accept',deleteConfirm);function deleteConfirm(){var id=$('.deleteId').attr('value');$.post("/crm/bill/deletesalary",{id:id},function(rs){var html='<div class="alert alert-success alert-dismissable">'+rs.messages+'</div>';if(rs.code>0){$("#myModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);setTimeout(function(){window.location.reload();},500);}else{var html='<div class="alert alert-warning alert-dismissable"> '+rs.messages+'</div>';$("#myModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}});}
$('.changeStatus').on('click',function(){var id=$(this).attr('data-id');$('#changeStatusModal .saveChangeStatus').attr('data-id',id);$('#changeStatusModal').modal('show');})
$('#changeStatusModal .saveChangeStatus').on('click',function(){var id=$(this).attr('data-id');if(!isSubmit){isSubmit=true;$.post('/crm/bill/updatestatussalary',{'id':id,},function(rs){if(rs.code){window.location.reload()}
else{$('#changeStatusModal').modal('hide');var message='<div class="alert alert-danger" >'+rs.messages+'</div>';$('#alertModel .modal-body').append(message);$('#alertModel').modal('show');}});}});$('.addNhanhStore').on('click',function(){var contractId=$(this).attr('data-contractid');$('#updateNhanhStoreIdModal .showContractId').empty().text(contractId);$('#updateNhanhStoreIdModal .contractId-txt').empty().val(contractId);$('#updateNhanhStoreIdModal').modal('show');})
$('#updateNhanhStoreIdModal .saveNhanhStore').on('click',function(){var contractId=$('#updateNhanhStoreIdModal .contractId-txt').val();var nhanhStoreId=$('#updateNhanhStoreIdModal .nhanhStoreId').val();var nhanhStoreName=$('#updateNhanhStoreIdModal .nhanhStoreName').val();if(!nhanhStoreId||!nhanhStoreName){alert('Bạn chưa nhập ID hoặc tên doanh nghiệp trên Nhanh');return false;}
$.post('/crm/bill/updatenhanhstorename',{'contractId':contractId,'nhanhStoreId':nhanhStoreId,'nhanhStoreName':nhanhStoreName,},function(rs){if(rs.code){window.location.reload()}
else{$('#updateNhanhStoreIdModal').modal('hide');var message='<div class="alert alert-danger" >'+rs.messages+'</div>';$('#alertModel .modal-body').append(message);$('#alertModel').modal('show');}});});});