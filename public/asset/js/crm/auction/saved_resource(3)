$(function(){$('#exportAll').jsExcelExport({'param':{'format':'csv'}});$('#exportExcel').jsExcelExport({'param':{'format':'excel'}});Department.load('#companyId','#departmentId','hrm.managerCompany');AuctionCategory.load('#companyId','#categoryId','');$('.updateStatus').click(function(){$('#loadingColorModal').fadeToggle();$.post('/crm/auction/updatestatus',{},function(rs){$('#loadingColorModal').fadeToggle(1500);location.reload();});});$('.deleteAuction').on('click',function(){var item=$(this);$.post("/crm/auction/delete",{'id':$(this).attr('data-id'),},function(rs){if(rs.code){item.closest('td').closest('tr').remove();}else{var html='<div class="alert alert-warning alert-dismissable"> '+rs.messages+'</div>';$("#myModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}});});$('#dgAuction').on('click','.reapprove',function(){var id=$(this).data('id');$('#confirmReapproveModal .referId').val(id);$('#confirmReapproveModal .alert').html('Bạn muốn hoàn duyệt phiên đấu giá '+id);$('#confirmReapproveModal').modal('show');});$('#confirmReapproveModal .btnSave').click(function(){var id=$('#confirmReapproveModal .referId').val();$('#confirmReapproveModal').modal('hide');$('#loadingModal').modal('show');$.post('/crm/auction/reapprove',{'id':id},function(rs){$('#loadingModal').modal('hide');if(rs.code){var tr=$('#dgAuction .reapprove[data-id="'+id+'"]').closest('tr');tr.find('.colStatus').html('<a class="text-success" data-toggle="tooltip" title="Bấm để duyệt" href="/crm/auction/approve?id='+id+'"><b>Chưa duyệt</b></a>');tr.find('.reapprove').remove();}else{$('#errorModal .alert').html(rs.messages.join('<br/>'));$('#errorModal').modal('show');}});});$('.reload').on('click',function(){window.location.reload();})});var AuctionCategory={load:function(cId,dId,option){var c=cId?cId:'#companyId';var d=dId?dId:'#categoryId';if($(c).val()&&!$(d).val()){AuctionCategory.getCatefgories($(c).val(),d,'',option);}
$(c).change(function(){if($(this).val()&&$(d).length){AuctionCategory.getCatefgories($(this).val(),d,'',option);}});},getCatefgories:function(cid,dId,sel,option){$.post('/crm/auction/loadcategory?companyId='+cid,{'page':option},function(rp){if(rp.code){AuctionCategory.updateSelect(dId,rp.data,sel);}else{AuctionCategory.updateSelect(dId,[],sel);}},'json');},updateSelect:function(id,d,sel){if($(id).length){var options="";for(var i in d){var item=d[i];if(sel==item.id){options+="<option selected value='"+item.id+"'>"+item.name+"</option>";}else{options+="<option value='"+item.id+"'>"+item.name+"</option>";}}
if(!$(id).find('option:first').val()){options="<option value=''>"+$(id).find('option:first').text()+"</option>"+options;}
$(id).html(options);}}};