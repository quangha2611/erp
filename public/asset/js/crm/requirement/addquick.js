var CustomerAddquick={init:function(configs){var configs=$.extend({'element':'','afterAdd':function(customerData){}},configs);if(!$(configs.element).length){return false;}
this.afterAdd=configs.afterAdd;$(configs.element).click(function(){$('#customerAddquickModal').modal('show');})
CustomerAddquick.addContact();$('#customerAddquickModal .addContact').on('click',function(){CustomerAddquick.addContact();});$('#customerAddquickModal .customer-contacts').on('click','.removeContact',function(){$(this).closest('tr').remove();});$('#customerAddquickModal .customer-contacts').on('change','.contactContent',function(){var formFeedback=$(this).parent();var feedbackIcon=formFeedback.find('.form-control-feedback');formFeedback.removeClass('has-success has-error');feedbackIcon.removeClass('fa-check fa-times fa-spin fa-circle-o-notch').addClass('fa-spin fa-circle-o-notch');CustomerAddquick.checkContact(formFeedback)});$('#customerAddquickModal .btnSave').on('click',function(){if(CustomerAddquick.checkForm()){CustomerAddquick.submit();}});},afterAdd:function(customerData){},checkContact:function(formFeedback){var type=formFeedback.closest('tr').find('.contactType').val();var value=formFeedback.find('.contactContent').val();if(!type||!value){return this.setContactError(formFeedback,['Bạn phải điền đủ loại và chi tiết liên hệ'])}
if(type=='address'){return this.setContactSuccess(formFeedback);}
$.post('/crm/customer/isexisted',{'type':type,'value':value},function(rs){if(typeof rs.code=='undefined'){$('#customerAddquickModal').modal('hide');if($('#errorModal').length){$('#errorModal .alert').html('Có lỗi trong quá trình thực hiện');}else{alert('Có lỗi trong quá trình thực hiện');}}else{if(rs.code){CustomerAddquick.setContactSuccess(formFeedback);}else{CustomerAddquick.setContactError(formFeedback,rs.messages);}}});},addContact:function(){var template=$('#customerContactTemplate tr').clone();$('#customerAddquickModal .customer-contacts tbody').append(template);},setContactSuccess:function(contact){contact.removeClass('has-error has-success').addClass('has-success');contact.find('.form-control-feedback').removeClass('fa-check fa-times fa-spin fa-circle-o-notch').addClass('fa-check');contact.find('.help-block').html('');},setContactError:function(contact,messages){contact.removeClass('has-error has-success').addClass('has-error');contact.find('.form-control-feedback').removeClass('fa-check fa-times fa-spin fa-circle-o-notch').addClass('fa-times');contact.find('.help-block').html(messages.join('<br/>'));},checkForm:function(){$isVaild=true;$('#customerAddquickModal .has-error').removeClass('has-error');if(!$('#customerAddquickModal .customer-type').val()){$isVaild=false;$('#customerAddquickModal .customer-type').closest('.form-group').addClass('has-error');}
if(!$('#customerAddquickModal .customer-name').val()){$isVaild=false;$('#customerAddquickModal .customer-name').closest('.form-group').addClass('has-error');}
var informations=[];$('#customerAddquickModal .customer-contacts tbody tr').each(function(){if($(this).find('.contactType').val()&&$(this).find('.contactContent').val()){informations.push({'type':$(this).find('.contactType').val(),'value':$(this).find('.contactContent').val(),});}});if(!informations.length){$isVaild=false;}else{$('#customerAddquickModal .customer-informations').val(JSON.stringify(informations))}},submit:function(){$('#customerAddquickModal .btnSave').prop('disabled',true);$.post('/crm/customer/addquick',$('customerAddquickForm').serialize(),function(rs){if(typeof rs.code=='undefined'){$('#customerAddquickModal').modal('hide');if($('#errorModal').length){$('#errorModal .alert').html('Có lỗi trong quá trình thực hiện');}else{alert('Có lỗi trong quá trình thực hiện');}}else{$('#customerAddquickModal .btnSave').prop('false',true);$('#customerAddquickModal').modal('hide');if(rs.code){CustomerAddquick.afterAdd(rs.data);}else{if($('#errorModal').length){$('#errorModal .alert').html(rs.mesages.join('<br/>'));}else{alert(rs.mesages.join('\n'));}}}});}};