$(function(){CustomerAddquick.init({'element':'#btnAddNewCustomer','afterAdd':function(customerData){}});$('#customerName').catcomplete({source:function(request,response){$.post('/crm/customer/suggest',{'q':request.term,'page':'customer.catcomplete.leadAndAccount'},function(rs){if(rs.code){response(rs.data);}});},response:function(event,ui){if(typeof ui.content=='undefined'||ui.content.length===0){$(".empty-message").show();}else{$(".empty-message").hide();}},minLength:2,select:function(event,ui){if(ui.item.crmType=='lead'){$('#leadId').val(ui.item.id);$('#accountId').val(ui.item.accountId);}
if(ui.item.crmType=='account'){$('#accountId').val(ui.item.id);$('#leadId').val('');}
if(typeof ui.item.type!="undefined"){$('#customerType').val(ui.item.type);}else{$('#customerType').val('');}
if(typeof ui.item.name!="undefined"||typeof ui.item.companyName!="undefined"){var text=ui.item.companyName?ui.item.companyName:ui.item.name;$('#customer-Name').val(text);}else{$('#customer-Name').val('');}
if(typeof ui.item.mobile!='undefined'){var text=ui.item.mobile.join(' - ');$('#customerMobile').val(text);}else{$('#customerMobile').val('');}
if(typeof ui.item.email!='undefined'){var text=ui.item.email.join(' - ');$('#customerEmail').val(text);}else{$('#customerEmail').val('');}
if(typeof ui.item.address!='undefined'){var text=ui.item.address;$('#customerAddress').val(text);}else{$('#customerAddress').val('');}
if(typeof ui.item.taxCode!='undefined'){var text=ui.item.taxCode.shift();$('#customerTaxcode').val(text);}else{$('#customerTaxcode').val('');}
if(typeof ui.item.identification!='undefined'){var info=ui.item.identification.shift();if(typeof info.content!='undefined'&&info.extraContent!=null){$('#customerIdentification').val(info.content);}
if(typeof info.extraContent!='undefined'&&info.extraContent!=null){$('#customerIdentificationPlace').val(info.extraContent.place);var date=new moment(info.extraContent.date);$('#customerIdentificationDate').val(date.format('DD/MM/YYYY'));}else{$('#customerIdentification').val('');$('#customerIdentificationPlace').val('');$('#customerIdentificationPlace').val('');}}else{$('#customerIdentification').val('');$('#customerIdentificationPlace').val('');$('#customerIdentificationPlace').val('');}
if(typeof ui.item.nhanhStore!='undefined'){var info=ui.item.nhanhStore.shift();if(typeof info.extraContent!='undefined'&&info.extraContent!=null){$('#customerNhanhStoreId').val(info.extraContent.id);$('#customerNhanhStoreName').val(info.extraContent.name);}else{$('#customerNhanhStoreId').val('');$('#customerNhanhStoreName').val('');}}else{$('#customerNhanhStoreId').val('');$('#customerNhanhStoreName').val('');}
if(typeof ui.item.VGStore!='undefined'){var info=ui.item.VGStore.shift();if(typeof info.extraContent!='undefined'&&info.extraContent!=null){$('#customerVgStoreId').val(info.extraContent.id);$('#customerVgStoreName').val(info.extraContent.name);}else{$('#customerVgStoreId').val('');$('#customerVgStoreName').val('');}}else{$('#customerVgStoreId').val('');$('#customerVgStoreName').val('');}
if(typeof ui.item.fax!='undefined'){var text=ui.item.fax.join(' - ');$('#customerFax').val(text);}else{$('#customerFax').val('');}
if(typeof ui.item.website!='undefined'){var text=ui.item.website.join(' - ');$('#customerWebsite').val(text);}else{$('#customerWebsite').val('');}
if(typeof ui.item.representator!='undefined'){var info=ui.item.representator.shift();if(typeof info.extraContent!='undefined'&&info.extraContent!=null){$('#customerRepresentatorName').val(info.extraContent.name);$('#customerRepresentatorTitle').val(info.extraContent.title);$('#customerRepresentatorEmail').val(info.extraContent.email);$('#customerRepresentatorMobile').val(info.extraContent.mobile);}else{$('#customerRepresentatorName').val('');$('#customerRepresentatorTitle').val('');$('#customerRepresentatorEmail').val('');$('#customerRepresentatorMobile').val('');}}else{$('#customerRepresentatorName').val('');$('#customerRepresentatorTitle').val('');$('#customerRepresentatorEmail').val('');$('#customerRepresentatorMobile').val('');}
$('.customerInfor').slideDown(300);},});$('.btnSave').on('click',function(){var $informations=[];$('.customer-contacts tbody tr').each(function(){var trValue={'type':$(this).find('.contactType').val(),'value':$(this).find('.contactContent').val(),};$informations.push(trValue);});$('.customer-informations').val(JSON.stringify($informations));$.post('/crm/customer/addquick',{'type':$('.customer-type').val(),'name':$('.customer-name').val(),'servicePrivateId':$('.customer-servicePrivateId').val(),'servicePrivateName':$('.customer-servicePrivateName').val(),'informations':$('.customer-informations').val(),},function(rs){if(rs.code){html='<div class="alert alert-success alert-dismissable">Thêm khách hàng thành công</div>';$("#customerAddquickModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);$('#leadId').val(rs.data.id);$('#customer-Name').val(rs.data.name);$('#customerName').val(rs.data.name);$('.customerInfor').slideDown(300);}else{html='<div class="alert alert-warning alert-dismissable">'+rs.messages+'</div>';$("#customerAddquickModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}});});});