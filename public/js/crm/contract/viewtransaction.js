$(function(){$('#AddBill').on('click',function(){$('#BillModal').modal('show');});$('.confirmBill').on('click',function(){var billId=$('#billId').val();var billCode=$('#billCode').val();var billDate=$('#billDate').val();var billValue=$('#billValue').val();var billNote=$('#billNote').val();var transactionId=$('#transactionId').val();var isStatus=$('#billStatus');var billStatus='';if(isStatus.is(":checked")){billStatus='2'}else{billStatus='1'}
console.log(billId);if(!billId){$.post('/crm/contract/addbill',{'code':billCode,'applyDate':billDate,'value':billValue,'description':billNote,'transactionId':transactionId,'status':billStatus,},function(rs){$('#BillModal').modal('show');$('#BillModal .modal-body').append(rs);if(rs.code){var message='<div class="alert alert-success" >'+rs.messages+'</div>';$('#BillModal .modal-body').empty();$('#BillModal .modal-body').html(message);$('#BillModal .modal-footer').toggle(50);setTimeout(function(){location.reload();},1000);}
else{$('#BillModal .modal-body .alert-danger').show();$('#BillModal .modal-body .alert-danger').html(rs.messages);setTimeout(function(){$('#BillModal .modal-body .alert-danger').fadeOut(100);},5000);}});}else{$.post('/crm/contract/updatebill',{'billId':billId,'code':billCode,'applyDate':billDate,'value':billValue,'description':billNote,'transactionId':transactionId,'status':billStatus,},function(rs){$('#BillModal').modal('show');$('#BillModal .modal-body').append(rs);if(rs.code){var message='<div class="alert alert-success" >'+rs.messages+'</div>';$('#BillModal .modal-body').empty();$('#BillModal .modal-body').html(message);$('#BillModal .modal-footer').toggle(50);setTimeout(function(){location.reload();},1000);}
else{$('#BillModal .modal-body .alert-danger').show();$('#BillModal .modal-body .alert-danger').html(rs.messages);setTimeout(function(){$('#BillModal .modal-body .alert-danger').fadeOut(100);},5000);}});}});$('.updateStampedById').on('click',function(){var id=$('#billId').val();var item=$(this);if(confirm('Bạn chắc chắn xác nhận đã nhận hóa đơn này không?')){$.post('/crm/bill/updatestamp',{'id':id,},function(rs){if(rs.code){html='<div class="alert alert-success alert-dismissable">'+rs.messages+'</div>';$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);item.closest('.updateStamped-area').empty().append('<b data-toggle="tooltip" data-title="Đã xác nhận" class="fa fa-check text-success"></b>');}else{html='<div class="alert alert-warning alert-dismissable">'+rs.messages+'</div>';$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}});}});$('#addComment').on('click',function(){if($('#commentInput').val()){$.post('/crm/contract/addcomment',{'contractId':contractId,'content':$('#commentInput').val()},function(rs){if(typeof rs.code=='undefined'){$('#errorModal .alert').html(MSG_POSTING_ERROR);$('#errorModal').modal('show');}else{if(rs.code){location.reload();}else{$('#errorModal .alert').html(rs.messages.join('<br/>'));$('#errorModal').modal('show');}}});}});$('#recalculatePayment').on('click',function(){var item=$(this);item.addClass('fa-spin');$.post('/crm/contract/recalculatepayment',{'transactionId':item.data('id')},function(rs){item.removeClass('fa-spin')
if(typeof rs.code=='undefined'){$('#errorModal .alert').html(MSG_POSTING_ERROR);$('#errorModal').modal('show');}else{if(rs.code){location.reload();}else{$('#errorModal .alert').html(rs.messages.join('<br/>'));$('#errorModal').modal('show');}}});});$('#delete-item').click(function(){var id=$(this).attr('data-id');if(id!=""){var html="<div class='alert alert-info alert-dismissable'>Xác nhận hủy phiếu thu?</div>";$("#myModal").modal('show');$('#myModal .modal-body').empty();$('#myModal .modal-body').append(html);$('#myModal .modal-footer').append("<div class='deleteId' value='"+id+"'></div>");}})
$('#myModal .modal-footer').on('click','.confirm',deleteConfirm);function deleteConfirm(){var id=$('.deleteId').attr('value');$.post("/crm/contract/deletetransaction",{id:id},function(rs){var html='<div class="alert alert-success alert-dismissable"> Hủy phiếu thu thành công</div>';if(rs.code>0){$("#myModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}else{var html='<div class="alert alert-warning alert-dismissable"> '+rs.messages+'</div>';$("#myModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}})}
Department.load('#companyId','#departmentId','crm.managerCompany');$('#add-requirement-item').on('click',function(){$('#addRequirementModal').modal('show');});if($('input[name=selectRequirement]:checked').val()==1){$('#requirement-infor-group').css('display','none');$('#requirement-id').val('');}
if($('input[name=selectRequirement]:checked').val()==2){$('#requirement-id-group').css('display','none');}
$('input[name=selectRequirement').click(function(){if($('input[name=selectRequirement]:checked').val()==1){$('#requirement-infor-group').fadeOut('slow');$('#requirement-id-group').fadeIn('slow');}
if($('input[name=selectRequirement]:checked').val()==2){$('#requirement-id-group').fadeOut('slow');$('#requirement-infor-group').fadeIn('slow');$('#requirement-id').val('');}});$('.confirm-requiremnent').on('click',function(){$.post("/crm/requirement/addvgajax",{'id':$('#requirement-id').val(),'transactionId':$('#transactionId').val(),'contractId':contractId,'assignedToCompanyId':$('#companyId').val(),'assignedToDepartmentId':$('#departmentId').val(),'value':$('#requirement-price').val(),'productId':$('#lst-product').val(),'leadId':$('#leadId').val(),'accountId':$('#accountId').val(),},function(rs){var html='<div class="alert alert-success alert-dismissable">'+rs.messages+'</div>';if(rs.code>0){$("#addRequirementModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}else{var html='<div class="alert alert-warning alert-dismissable"> '+rs.messages+'</div>';$("#addRequirementModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}})});$('#reapprove-item').on('click',function(){$('#reapproveModal').modal('show');})
$('#reapproveModal .save-approve').on('click',function(){$.post("/crm/contract/reapprovetransaction",{'id':$('#transactionId').val(),'reason':$('#reason').val(),},function(rs){var html='<div class="alert alert-success alert-dismissable">'+rs.messages+'</div>';if(rs.code>0){$("#reapproveModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}else{var html='<div class="alert alert-warning alert-dismissable"> '+rs.messages+'</div>';$("#reapproveModal").modal('hide');$("#alertModal").modal('show');$('#alertModal .modal-body').empty();$('#alertModal .modal-body').append(html);}})});});