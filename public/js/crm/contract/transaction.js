var isSubmit=false;$(function(){Filter.init();$('#exportExcel').jsExcelExport({'param':{'format':'excel'}});$('#exportAll').jsExcelExport({'param':{'format':'csv'}});$('#exportContractAll').jsExcelExport({'param':{'format':'contractexcel'}});$('#productId').multiselect({enableCaseInsensitiveFiltering:true,nonSelectedText:'Sản phẩm'});Department.load('#companyId','#departmentId');$('#dgContractPayment').on('click','.deleteTransaction',function(){var id=$(this).data('id');$('#confirmModal .referId').val(id);$('#confirmModal').modal('show');});$('#confirmModal .accept').click(function(){var id=$('#confirmModal .referId').val();$('#confirmModal').modal('hide');$('#loadingModal').modal('show');$.post('/crm/contract/deletetransaction',{'id':id},function(rs){$('#loadingModal').modal('hide');if(typeof rs.code!='undefined'){if(rs.code){var tr=$('#dgContractPayment .deleteTransaction[data-id="'+id+'"]').closest('tr');tr.find('td.col-status').html('<i class="fa fa-minus-circle text-danger icon"></i>');}else{$('#errorModal .alert').html(rs.messages.join('<br/>'));$('#errorModal').modal('show');}}else{$('#errorModal .alert').html(SERVER_ERROR_MSG);$('#errorModal').modal('show');}});})
$('#customerName').catcomplete({source:function(request,response){$.post('/crm/customer/suggest',{'q':request.term,'page':'customer.catcomplete.leadAndAccount'},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){if(ui.item.crmType=='lead'){$('#leadId').val(ui.item.id);$('#accountId').val(ui.item.accountId);}
if(ui.item.crmType=='account'){$('#accountId').val(ui.item.id);$('#leadId').val('');}},});$('#commisstionToName').autocomplete({source:function(request,response){$.post('/hrm/employee/suggest',{'q':request.term},function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){$('#commisstionToEmployeeId').val(ui.item.id);},});AccountingAccount.load('#companyId','#accountTransactionId');$('#accountTransactionId').select2();});var Filter={init:function(){Filter.userSuggetInit('#createdByName','#createdById');Filter.userSuggetInit('#accountingByName','#accountingById');},userSuggetInit:function(nameElement,idElement,options){if(!nameElement||!idElement){return false;}
if(!$(nameElement).length||!$(idElement).length){return false;}
var settings={'uri':'/hrm/employee/suggest','param':{'page':'category.hrm',},'selectHandler':function(event,ui){$(idElement).val(ui.item.userId)}};if(typeof options!='undefined'){jQuery.extend(settings,options);}
$(nameElement).catcomplete({source:function(request,response){var param={'page':'category.hrm','q':request.term,}
jQuery.extend(param,settings.param);$.post(settings.uri,param,function(rs){if(rs.code){response(rs.data);}});},minLength:2,select:function(event,ui){settings.selectHandler(event,ui)},});$(nameElement).on('change',function(){if(!$(nameElement).val()){$(idElement).val('');}});}};